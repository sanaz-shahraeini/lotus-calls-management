{% extends 'base.html' %}
{% load static %}

{% block title %}تغییر رمز عبور{% endblock %}

{% block head_extra %}
<style>
    .password-change-container {
        max-width: 600px;
        margin: 50px auto;
        background-color: var(--card-bg);
        border-radius: 12px;
        box-shadow: var(--card-shadow);
        padding: 2rem;
        position: relative;
        overflow: hidden;
    }

    .password-change-container::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 6px;
        background: linear-gradient(to right, #00BCD4, #536DFE);
    }

    .password-change-title {
        font-size: 1.5rem;
        color: var(--text-color);
        margin-bottom: 1.5rem;
        text-align: center;
        font-weight: 600;
    }
    
    .info-message {
        background-color: rgba(0, 188, 212, 0.1);
        border-right: 4px solid #00BCD4;
        padding: 1rem;
        margin-bottom: 1.5rem;
        border-radius: 4px;
        color: var(--text-color);
    }

    html.dark .info-message {
        background-color: rgba(0, 188, 212, 0.05);
    }
</style>
{% endblock %}

{% block main %}
<div class="password-change-container">
    <h1 class="password-change-title">تغییر رمز عبور</h1>
    
    <div class="info-message">
        <p><i class="fa-solid fa-info-circle ml-2"></i>نیاز است رمز عبور خود را تغییر دهید. رمز عبور جدید باید امن باشد.</p>
    </div>
    
    {% if messages %}
        <div class="messages-container">
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }}">
                    <strong>{% if message.tags == 'error' %}خطا:{% elif message.tags == 'success' %}موفق:{% elif message.tags == 'warning' %}هشدار:{% endif %}</strong>
                    {{ message }}
                </div>
            {% endfor %}
        </div>
    {% endif %}
    
    <form method="post">
        {% csrf_token %}
        
        <div class="form-group">
            <label for="new_password" class="form-label">رمز عبور جدید</label>
            <input type="password" id="new_password" name="new_password" class="form-input" required>
        </div>
        
        <div class="form-group">
            <label for="confirm_password" class="form-label">تکرار رمز عبور جدید</label>
            <input type="password" id="confirm_password" name="confirm_password" class="form-input" required>
            <div class="password-rules">
                <strong>قوانین رمز عبور:</strong>
                <ul>
                    <li>حداقل 8 کاراکتر</li>
                    <li>حداقل یک حرف بزرگ انگلیسی (A-Z)</li>
                    <li>حداقل یک حرف کوچک انگلیسی (a-z)</li>
                    <li>حداقل یک عدد (0-9)</li>
                    <li>حداقل یک کاراکتر خاص مانند !@#$%^&*()_+-=[]{};:,.?</li>
                    <li>نباید همان رمز عبور پیش‌فرض (12345678) باشد</li>
                </ul>
            </div>
        </div>
        
        <button type="submit" class="submit-btn">تغییر رمز عبور</button>
    </form>
</div>

{% endblock %}

{% block js_extra %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // پنهان کردن دکمه‌های راهبری برای این صفحه
        const sidebarLinks = document.querySelectorAll('.sidebar a');
        if (sidebarLinks) {
            sidebarLinks.forEach(link => {
                if (link.href.includes('dashboard')) {
                    link.style.pointerEvents = 'none';
                    link.style.opacity = '0.5';
                }
            });
        }
        
        // بررسی تطابق رمزهای عبور
        const form = document.querySelector('form');
        const newPassword = document.getElementById('new_password');
        const confirmPassword = document.getElementById('confirm_password');
        
        // تابع بررسی پیچیدگی رمز عبور
        function validatePasswordComplexity(password) {
            // بررسی طول رمز عبور
            if (password.length < 8) {
                return { valid: false, message: 'رمز عبور باید حداقل 8 کاراکتر باشد.' };
            }
            
            // بررسی وجود حروف بزرگ انگلیسی
            if (!/[A-Z]/.test(password)) {
                return { valid: false, message: 'رمز عبور باید حداقل شامل یک حرف بزرگ انگلیسی باشد.' };
            }
            
            // بررسی وجود حروف کوچک انگلیسی
            if (!/[a-z]/.test(password)) {
                return { valid: false, message: 'رمز عبور باید حداقل شامل یک حرف کوچک انگلیسی باشد.' };
            }
            
            // بررسی وجود اعداد
            if (!/[0-9]/.test(password)) {
                return { valid: false, message: 'رمز عبور باید حداقل شامل یک عدد باشد.' };
            }
            
            // بررسی وجود کاراکترهای خاص
            if (!/[!@#$%^&*()_+\-=\[\]{}|;:'",./<>?~]/.test(password)) {
                return { valid: false, message: 'رمز عبور باید حداقل شامل یک کاراکتر خاص مانند !@#$%^&* باشد.' };
            }
            
            // بررسی عدم استفاده از رمز عبور پیش‌فرض
            if (password === "12345678") {
                return { valid: false, message: 'رمز عبور نمی‌تواند همان رمز عبور پیش‌فرض باشد.' };
            }
            
            return { valid: true, message: '' };
        }
        
        form.addEventListener('submit', function(e) {
            if (newPassword.value !== confirmPassword.value) {
                e.preventDefault();
                alert('رمزهای عبور مطابقت ندارند.');
                return false;
            }
            
            // بررسی پیچیدگی رمز عبور
            const result = validatePasswordComplexity(newPassword.value);
            if (!result.valid) {
                e.preventDefault();
                alert(result.message);
                return false;
            }
            
            return true;
        });
    });
</script>
{% endblock %} 