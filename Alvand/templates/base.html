{% load static baseTags userProfileTags %}
<!DOCTYPE html>
<html lang="fa" dir="rtl" class="light">
<head>
    <title>لوتوس - {{ pageTitle }}</title>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, shrink-to-fit=no, maximum-scale=1, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <script src="{% static 'dist/jalalidatepicker.js' %}"></script>
    <link rel="stylesheet" href="{% static 'dist/jalalidatepicker.css' %}"/>
    <link href="{% static 'fontawesomefree/css/fontawesome.css' %}" rel="stylesheet" type="text/css">
    <link href="{% static 'fontawesomefree/css/brands.css' %}" rel="stylesheet" type="text/css">
    <link href="{% static 'fontawesomefree/css/solid.css' %}" rel="stylesheet" type="text/css">
    <link href="{% static 'fonts/css/iransans.css' %}" rel="stylesheet" type="text/css">
    <link href="{% static 'css/dist/styles.css' %}" rel="stylesheet" type="text/css">
    
    <!-- Shared CSS Components (bundled) -->
    <link href="{% static 'css/shared.bundle.css' %}" rel="stylesheet" type="text/css">
    
    <!-- Legacy/Specific CSS -->
    <link href="{% static 'css/app.css' %}" rel="stylesheet" type="text/css">
    <link href="{% static 'css/theme.css' %}" rel="stylesheet" type="text/css">
    <link href="{% static 'css/mobile-responsive-fix.css' %}" rel="stylesheet" type="text/css">
    <link href="{% static 'css/mobile-menu-fix.css' %}" rel="stylesheet" type="text/css">
    <link href="{% static 'css/sidebar-dark-mode.css' %}" rel="stylesheet" type="text/css">
    <link href="{% static 'css/dark-mode-fix.css' %}" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="{% static 'css/high-contrast-dark.css' %}">
    <link href="{% static 'css/sidebar-desktop-fix.css' %}" rel="stylesheet" type="text/css">
    <link href="{% static 'css/mobile-sidebar-fix.css' %}" rel="stylesheet" type="text/css">
    <link href="{% static 'css/mobile-sidebar-improved.css' %}" rel="stylesheet" type="text/css">
    <link href="{% static 'css/mobile-sidebar-toggle-fix.css' %}" rel="stylesheet" type="text/css">
    <link href="{% static 'css/mobile-links-fix.css' %}" rel="stylesheet" type="text/css">
    <link href="{% static 'css/sidebar-padding-fix.css' %}" rel="stylesheet" type="text/css">
    <link href="{% static 'css/search-filters-redesign.css' %}" rel="stylesheet" type="text/css">
    <link href="{% static 'css/consistent-form-elements.css' %}" rel="stylesheet" type="text/css">
    <link href="{% static 'css/settings-page-fix.css' %}" rel="stylesheet" type="text/css">
    <link href="{% static 'css/calendar.css' %}" rel="stylesheet" type="text/css">
    <link href="{% static 'css/theme-toggle-global-fix.css' %}" rel="stylesheet" type="text/css">
    <link rel="icon" href="{% static 'pic/logo.ico' %}" type="image/x-icon">

  

    {% block head_extra %}{% endblock %}
</head>

<body>
<div class="relative">
    <!-- Theme Toggle functionality preserved in JavaScript only -->

    {% include 'includes/sidebar.html' %}
    
    <div class="main-content {% if 'user' in request.session and not request.session.user|needsPasswordChange %}mr-0 lg:mr-[260px]{% else %}mr-0{% endif %}">
        {% include 'includes/navbar.html' %}
        
        <div class="content-wrapper px-4 py-6">
            {% include 'messages.html' %}
            {% block main %}{% endblock %}
        </div>
    </div>
</div>

<script src="{% static 'js/jquery.js' %}"></script>
<script>
    // Theme toggle functionality
    $(document).ready(function() {
        // Get the theme toggle button
        const themeToggle = $("#theme-toggle");
        
        // Check for saved theme preference or use default
        const savedTheme = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
        document.documentElement.className = savedTheme;
        
        // Apply all theme-related styles based on the current theme
        function applyTheme(theme) {
            if (theme === 'dark') {
                document.documentElement.classList.remove('light');
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
                document.documentElement.classList.add('light');
            }
            localStorage.setItem('theme', theme);
        }
        
        // Apply saved theme on page load
        applyTheme(savedTheme);
        
        // Listen for clicks on the theme toggle
        themeToggle.on('click', function() {
            // If current theme is light, switch to dark, and vice versa
            const newTheme = document.documentElement.classList.contains('dark') ? 'light' : 'dark';
            applyTheme(newTheme);
        });
    });

    // Removed problematic show-settings handlers that were causing conflicts
    // These elements don't exist in the current templates

    $(document).ready(function () {
        const sidebar = $("#mobile-sidebar");
        const toggleButton = $("#toggle-menu");
        const menuIcon = $("#menu-icon");
        let isSidebarOpen = false;

        // Initialize with hamburger icon (sidebar closed by default)
        menuIcon.removeClass("fa-times").addClass("fa-bars");
        
        // Hide toggle button on desktop (as a backup to CSS)
        function updateToggleButtonVisibility() {
            if (window.innerWidth >= 1024) {
                toggleButton.hide();
            } else {
                toggleButton.show();
            }
        }
        
        // Initial check
        updateToggleButtonVisibility();
        
        // Update on resize
        $(window).resize(function() {
            updateToggleButtonVisibility();
        });

        toggleButton.on('click', function () {
            isSidebarOpen = !isSidebarOpen;

            if (isSidebarOpen) {
                // Opening the sidebar
                sidebar.css("transform", "translateX(0)");
                $("body").addClass("overflow-hidden"); // Prevent scrolling when sidebar is open
                // Show close icon when sidebar is open
                menuIcon.removeClass("fa-bars").addClass("fa-times");
                toggleButton.removeClass("right-4").addClass("right-32");
            } else {
                // Closing the sidebar
                sidebar.css("transform", "translateX(100%)");
                $("body").removeClass("overflow-hidden"); // Allow scrolling when sidebar is closed
                // Show hamburger icon when sidebar is closed
                menuIcon.removeClass("fa-times").addClass("fa-bars");
                toggleButton.removeClass("right-32").addClass("right-4");
            }
        });

        // Close sidebar when clicking outside
        $(document).on('click', function(e) {
            if (isSidebarOpen && !sidebar.is(e.target) && sidebar.has(e.target).length === 0 && !toggleButton.is(e.target)) {
                isSidebarOpen = false;
                sidebar.css("transform", "translateX(100%)");
                $("body").removeClass("overflow-hidden");
                // Show hamburger icon when sidebar is closed
                menuIcon.removeClass("fa-times").addClass("fa-bars");
                toggleButton.removeClass("right-32").addClass("right-4");
            }
        });
    });

    $(document).ready(function () {
        const exit = $('#exit')
        const exitmodal = $('#exitmodal')
        const exit_mb = $('#exit-mb')
        const exitmodal_mb = $('#exitmodal-mb')
        
        // تابع برای نمایش مودال خروج
        function showExitModal(modal) {
            // اطمینان از پاک کردن هرگونه کلاس اضافی که ممکن است تداخل کند
            modal.removeClass('hidden');
            
            // اضافه کردن تأخیر برای اطمینان از نمایش صحیح
            setTimeout(function() {
                modal.css('opacity', '1');
                modal.find('.modal-content').css('transform', 'scale(1)');
            }, 10);
        }
        
        // تابع برای پنهان کردن مودال خروج
        function hideExitModal(modal) {
            // اضافه کردن تأخیر برای انیمیشن
            modal.css('opacity', '0');
            modal.find('.modal-content').css('transform', 'scale(0.95)');
            setTimeout(function() {
                modal.addClass('hidden');
            }, 300);
        }
        
        exit.on('click', function (e) {
            e.preventDefault();
            showExitModal(exitmodal);
        });
        
        exit_mb.on('click', function (e) {
            e.preventDefault();
            showExitModal(exitmodal_mb);
        });
        
        $('#close').on('click', function (e) {
            e.preventDefault();
            hideExitModal(exitmodal);
        });
        
        $('#close-mb').on('click', function (e) {
            e.preventDefault();
            hideExitModal(exitmodal_mb);
        });
    })
</script>
<script>
    jalaliDatepicker.startWatch({
        minDate: "attr",
        maxDate: "today",
        hideAfterChange: true,
        autoHide: true,
        showTodayBtn: true,
        showEmptyBtn: true
    });
</script>
<script src="{% static 'js/remove-theme-toggle.js' %}"></script>
<script src="{% static 'js/hamburger-fix.js' %}"></script>
<script src="{% static 'js/mobile-sidebar-fix.js' %}"></script>
<script src="{% static 'js/mobile-sidebar-improved.js' %}"></script>


<script src="{% static 'js/fix-form-heights.js' %}"></script>
{% block js_extra %}{% endblock %}
</body>
</html>
